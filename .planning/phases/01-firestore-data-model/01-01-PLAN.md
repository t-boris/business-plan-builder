---
phase: 01-firestore-data-model
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/types/business.ts, src/types/index.ts]
autonomous: true
---

<objective>
Define all TypeScript types and interfaces for the multi-business Firestore data model.

Purpose: Create the type foundation that every subsequent phase builds on â€” Business, BusinessProfile, BusinessTemplate, VariableDefinition, SectionSchema, FieldSchema. These types define the shape of Firestore documents for the entire platform.

Output: `src/types/business.ts` with all new types, updated barrel `src/types/index.ts`.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-firestore-data-model/01-RESEARCH.md
@.planning/phases/01-firestore-data-model/01-CONTEXT.md
@.planning/codebase/CONVENTIONS.md

@src/types/plan.ts
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create multi-business type definitions</name>
  <files>src/types/business.ts</files>
  <action>
Create `src/types/business.ts` with all new types for the multi-business data model. Follow the existing convention: all interfaces serializable (no methods) for Firestore compatibility, PascalCase names, no `I` prefix.

**Business types (root document: `businesses/{businessId}`):**

```
BusinessProfile {
  name: string                    // Business name
  type: BusinessType              // Template type used
  industry: string                // Free-text industry description
  location: string                // City/region
  description: string             // Business description
  currency: string                // e.g., "USD", "EUR"
}

Business {
  id: string
  ownerId: string                 // Firebase Auth UID of creator
  templateId: string              // Which template was used to create
  templateVersion: number         // Version of template at creation time
  profile: BusinessProfile
  roles: Record<string, BusinessRole>  // uid -> role
  enabledSections: string[]       // Section keys enabled for this business
  createdAt: string               // ISO timestamp
  updatedAt: string               // ISO timestamp
}

type BusinessRole = 'owner' | 'editor'
type BusinessType = 'saas' | 'service' | 'retail' | 'restaurant' | 'event' | 'manufacturing' | 'custom'
```

**Template types (root document: `templates/{templateId}`):**

```
BusinessTemplate {
  id: string
  name: string                    // "SaaS / Software"
  businessType: BusinessType
  version: number
  description: string
  icon: string                    // Lucide icon name
  sections: Record<string, SectionDefinition>    // sectionKey -> definition
  defaultVariables: Record<string, VariableDefinition>  // varId -> definition
  createdAt: string
  updatedAt: string
}

SectionDefinition {
  label: string                   // "Executive Summary"
  order: number                   // Display order
  isCore: boolean                 // true = shared across business types
  schema: Record<string, FieldSchema>  // fieldKey -> schema
  defaultData: Record<string, unknown> // Default values for fields
}

FieldSchema {
  type: FieldType
  label: string
  placeholder?: string
  required?: boolean
  children?: Record<string, FieldSchema>  // For 'group' type
  itemSchema?: FieldSchema        // For 'list' type (schema of each item)
}

type FieldType = 'text' | 'textarea' | 'number' | 'currency' | 'percent' | 'list' | 'group' | 'select' | 'boolean'
```

**Variable types (stored in scenario documents):**

```
VariableDefinition {
  id: string
  label: string
  type: VariableType
  category: string                // e.g., "revenue", "costs", "metrics"
  unit: VariableUnit
  value: number
  defaultValue: number
  formula?: string                // e.g., "materials + labor + shipping" (for computed)
  dependsOn?: string[]            // Variable IDs this depends on (incoming edges)
  dependents?: string[]           // Variable IDs that depend on this (outgoing edges)
  description?: string            // Tooltip/help text
  min?: number                    // UI constraint
  max?: number                    // UI constraint
  step?: number                   // UI slider step
}

type VariableType = 'input' | 'computed'
type VariableUnit = 'currency' | 'percent' | 'count' | 'months' | 'days' | 'hours' | 'ratio'
```

**Section document types (subcollection: `businesses/{businessId}/sections/{sectionKey}`):**

```
BusinessSection {
  sectionKey: string
  label: string
  order: number
  schema: Record<string, FieldSchema>
  data: Record<string, unknown>   // Flexible JSON data
  updatedAt: string
}
```

**Scenario document types (subcollection: `businesses/{businessId}/scenarios/{scenarioId}`):**

```
BusinessScenario {
  id: string
  name: string
  isDefault: boolean
  variables: Record<string, VariableDefinition>
  createdAt: string
  updatedAt: string
}
```

**User document types (root document: `users/{uid}`):**

```
UserProfile {
  uid: string
  email: string
  displayName: string
  createdAt: string
}
```

**Share/invite types:**

```
BusinessInvite {
  id: string
  businessId: string
  role: BusinessRole
  createdBy: string               // UID of inviter
  token: string                   // URL-safe token
  expiresAt: string               // ISO timestamp
  acceptedBy?: string             // UID of acceptor
  acceptedAt?: string
  status: InviteStatus
}

type InviteStatus = 'pending' | 'accepted' | 'expired' | 'revoked'
```

**IMPORTANT:**
- All types must be serializable for Firestore (no Date objects, use ISO strings)
- Use `Record<string, unknown>` for flexible JSON data fields (not `any`)
- Keep max 2 levels of nesting for Firestore compatibility
- Export every type and interface with named exports
- Do NOT modify `src/types/plan.ts` or `src/types/scenario.ts` (existing types remain for backward compatibility until Phase 3)
  </action>
  <verify>npx tsc --noEmit passes with no errors</verify>
  <done>All types defined, exported, and compile without errors. Types match the Firestore document structure from RESEARCH.md.</done>
</task>

<task type="auto">
  <name>Task 2: Update type barrel exports</name>
  <files>src/types/index.ts</files>
  <action>
Update `src/types/index.ts` to re-export all new types from `business.ts`.

Add a new export block after the existing exports:

```typescript
export type {
  BusinessProfile,
  Business,
  BusinessRole,
  BusinessType,
  BusinessTemplate,
  SectionDefinition,
  FieldSchema,
  FieldType,
  VariableDefinition,
  VariableType,
  VariableUnit,
  BusinessSection,
  BusinessScenario,
  UserProfile,
  BusinessInvite,
  InviteStatus,
} from './business.ts';
```

Keep existing exports from `plan.ts` and `scenario.ts` unchanged.
  </action>
  <verify>npx tsc --noEmit passes. Import `Business` from `@/types` in a scratch check.</verify>
  <done>All new types importable via `@/types` barrel. Existing type imports still work.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes with zero errors
- [ ] All types in `src/types/business.ts` are exported via barrel
- [ ] Types match the Firestore document structure from RESEARCH.md
- [ ] No modifications to existing `plan.ts` or `scenario.ts`
- [ ] All interfaces are serializable (no Date, no methods, no class instances)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Types define complete Firestore document structure for: businesses, templates, sections, scenarios, users, invites
- Types use proper TypeScript patterns (Record, union types, optional fields)
  </success_criteria>

<output>
After completion, create `.planning/phases/01-firestore-data-model/01-01-SUMMARY.md`
</output>
