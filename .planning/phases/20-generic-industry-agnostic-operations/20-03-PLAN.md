---
phase: 20-generic-industry-agnostic-operations
plan: 03
type: execute
wave: 2
depends_on: ["20-01"]
files_modified: [src/lib/ai/section-prompts.ts]
autonomous: true
---

<objective>
Rewrite the AI schema and prompts for Operations to match the new generic data model.

Purpose: AI generation produces data matching the new Operations type (workforce, capacity, costItems, operationalMetrics) instead of the old event-specific CostBreakdown.
Output: Updated OperationsSchema, CrewMemberSchema → WorkforceMemberSchema, CostBreakdownSchema removed, new CostItemSchema/OperationalMetricSchema, updated prompts.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-generic-industry-agnostic-operations/20-CONTEXT.md
@.planning/phases/20-generic-industry-agnostic-operations/20-01-SUMMARY.md

@src/lib/ai/section-prompts.ts
@src/types/plan.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite Operations Zod schemas</name>
  <files>src/lib/ai/section-prompts.ts</files>
  <action>
  Replace the old schemas related to Operations with new ones matching the generic model.

  **Remove:**
  - `CrewMemberSchema` (or rename to `WorkforceMemberSchema`)
  - `CostBreakdownSchema` (entire thing — 30+ fields)
  - Old `OperationsSchema`

  **Add:**

  ```ts
  const WorkforceMemberSchema = z.object({
    role: z.string().describe('Job role or position title'),
    count: z.number().describe('Number of people in this role'),
    ratePerHour: z.number().describe('Hourly rate for this role'),
  });

  const CapacityConfigSchema = z.object({
    outputUnitLabel: z.string().describe('What the business produces: units, orders, bookings, meals, etc.'),
    plannedOutputPerMonth: z.number().describe('Planned monthly output volume'),
    maxOutputPerDay: z.number().describe('Maximum output capacity per day'),
    maxOutputPerWeek: z.number().describe('Maximum output capacity per week'),
    maxOutputPerMonth: z.number().describe('Maximum output capacity per month'),
    utilizationRate: z.number().describe('Target utilization rate as percentage 0-100'),
  });

  const CostItemSchema = z.object({
    category: z.string().describe('Cost category name, e.g. Raw Materials, Rent, Software'),
    type: z.enum(['variable', 'fixed']).describe('Variable costs scale with output, fixed costs stay constant'),
    rate: z.number().describe('Cost amount per driver unit'),
    driverType: z.enum(['per-unit', 'per-order', 'per-service-hour', 'per-machine-hour', 'monthly', 'quarterly', 'yearly'])
      .describe('What drives this cost: per unit of output, per time period, etc.'),
    driverQuantityPerMonth: z.number().describe('How many driver units per month'),
  });

  const OperationalMetricSchema = z.object({
    name: z.string().describe('Metric name, e.g. Yield Rate, OEE, Customer Satisfaction'),
    unit: z.string().describe('Measurement unit: %, units, hours, score'),
    value: z.number().describe('Current measured value'),
    target: z.number().describe('Target value to achieve'),
  });

  const OperationsSchema = z.object({
    workforce: z.array(WorkforceMemberSchema).describe('Team members and their roles'),
    capacity: CapacityConfigSchema,
    costItems: z.array(CostItemSchema).describe('All operational costs — both variable and fixed'),
    equipment: z.array(z.string()).describe('List of equipment and tools'),
    safetyProtocols: z.array(z.string()).describe('Safety procedures and protocols'),
    operationalMetrics: z.array(OperationalMetricSchema).describe('Key operational performance metrics'),
  });
  ```

  Make sure the schema name `OperationsSchema` is used in the `SECTION_PROMPTS` config the same way as before (the config key for `'operations'` should use the new schema).
  </action>
  <verify>`npx tsc --noEmit 2>&1 | grep section-prompts` — no type errors in section-prompts.ts</verify>
  <done>
  - Old CostBreakdownSchema removed (24+ fields)
  - New schemas: WorkforceMemberSchema, CapacityConfigSchema, CostItemSchema, OperationalMetricSchema
  - OperationsSchema uses all new sub-schemas
  - Schema properly wired into SECTION_PROMPTS config
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Operations prompts and industry overlays</name>
  <files>src/lib/ai/section-prompts.ts</files>
  <action>
  Update the base prompts and industry overlays for Operations.

  **Base prompts (in SECTION_PROMPTS['operations']):**

  - `generate`: "Generate an operations plan. Include workforce (roles, headcount, hourly rates), capacity planning (output units, planned volume, max capacity, utilization target), cost items (both variable costs that scale with output and fixed monthly costs, each with category, rate, and cost driver), equipment list, safety protocols, and operational metrics (KPIs with current values and targets). Use realistic estimates for the business type and location."

  - `improve`: "Improve the existing operations plan. Keep all current data, refine cost estimates to be more realistic for the business's market, enhance safety protocols, optimize capacity planning, and add any missing operational metrics."

  - `expand`: "Expand the existing operations plan with more detail. Keep all current data, add more cost items for completeness, elaborate on safety protocols, add operational metrics for quality and efficiency, and refine workforce planning."

  **Industry overlays (INDUSTRY_OVERLAYS for operations):**

  Update ALL business types to use generic language. No event-specific, no manufacturing-specific vocabulary. Each overlay guides the AI to fill the generic fields appropriately:

  - `saas`: "Workforce should include engineering, product, and customer success roles. Capacity units are 'active users' or 'API requests'. Variable costs: cloud infrastructure per user, API costs per request. Fixed costs: SaaS tools, office, insurance. Operational metrics: uptime %, deployment frequency, MTTR, customer churn rate."

  - `restaurant`: "Workforce should include kitchen and front-of-house roles with shift-based rates. Capacity units are 'covers' or 'meals'. Variable costs: food cost per cover, disposables per cover. Fixed costs: rent, utilities, POS, insurance. Operational metrics: food cost %, table turnover, average ticket, waste rate."

  - `retail`: "Workforce should include store associates, managers, warehouse staff. Capacity units are 'transactions' or 'orders'. Variable costs: COGS per unit, packaging per order, payment processing. Fixed costs: rent, utilities, POS, shrinkage budget. Operational metrics: conversion rate, average basket size, inventory turnover, shrinkage %."

  - `service`: "Workforce should include service professionals and support staff with utilization-based rates. Capacity units are 'billable hours' or 'engagements'. Variable costs: travel per engagement, materials per service. Fixed costs: tools, insurance, professional development. Operational metrics: utilization rate, client satisfaction, repeat rate."

  - `event`: "Workforce should include event crew with per-event rates. Capacity units are 'events' or 'bookings'. Variable costs: supplies per event, venue/rental per event, transportation per event. Fixed costs: storage, insurance, marketing, software. Operational metrics: booking fill rate, NPS, repeat booking rate."

  - `manufacturing`: "Workforce should include production operators, quality inspectors, maintenance technicians. Capacity units are 'units produced'. Variable costs: raw materials per unit, packaging per unit, energy per machine-hour. Fixed costs: facility lease, equipment depreciation, insurance, maintenance contracts. Operational metrics: yield rate, scrap rate, OEE, cycle time, on-time delivery rate."

  - `custom`: Keep using base prompt only (no overlay), same as before.

  After updating, verify the build passes.
  </action>
  <verify>`npx vite build 2>&1 | tail -5` — build succeeds</verify>
  <done>
  - All Operations prompts use generic language
  - Industry overlays guide AI to fill generic fields appropriately per business type
  - No event-specific or manufacturing-specific field names in any prompt
  - One schema for all business types
  - Build passes
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx vite build` succeeds
- [ ] OperationsSchema matches new Operations type exactly
- [ ] No CostBreakdown references remain in section-prompts.ts
- [ ] All 6 industry overlays updated for generic model
- [ ] No event-specific field names in prompts
</verification>

<success_criteria>

- AI generates Operations data matching new generic types
- One schema works for all business types
- Industry overlays use generic language to guide context-appropriate output
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/20-generic-industry-agnostic-operations/20-03-SUMMARY.md`
</output>
