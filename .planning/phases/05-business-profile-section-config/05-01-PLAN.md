---
phase: 05-business-profile-section-config
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/use-businesses.ts
  - src/components/ui/switch.tsx
  - src/components/ui/collapsible.tsx
autonomous: true
---

<objective>
Add business profile update and section toggle methods to the useBusinesses hook, and install shadcn UI primitives needed for the header bar.

Purpose: Provide the data layer that Plan 05-02's BusinessHeaderBar component will consume. Profile updates and section toggles need optimistic local state updates (so sidebar/header react instantly) plus background Firestore persistence.

Output: useBusinesses hook with `updateProfile` and `toggleSection` methods. shadcn Switch and Collapsible components available.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/05-business-profile-section-config/05-CONTEXT.md

@src/hooks/use-businesses.ts
@src/store/business-atoms.ts
@src/lib/business-firestore.ts
@src/types/business.ts
@src/lib/constants.ts
</context>

<tasks>
<task type="auto">
  <name>Task 1: Add updateProfile and toggleSection to useBusinesses hook</name>
  <files>
    src/hooks/use-businesses.ts
  </files>
  <action>
    Add two new methods to the `useBusinesses` hook return value:

    **`updateProfile(fields: Partial<BusinessProfile>)`:**
    - Guard: if no `activeBusiness`, return early.
    - Optimistic local update: call `setBusinessList(prev => prev.map(b => b.id === activeBusiness.id ? { ...b, profile: { ...b.profile, ...fields }, updatedAt: new Date().toISOString() } : b))`.
    - Firestore update: call `updateBusiness(activeBusiness.id, { profile: { ...activeBusiness.profile, ...fields } })` in background (fire-and-forget with `.catch()` error logging).
    - Import `updateBusiness` from `@/lib/business-firestore` (already partially imported — add to existing import).
    - Import `BusinessProfile` type from `@/types`.
    - NOTE: Firestore `setDoc` with `merge: true` does deep merge for nested objects, so passing the full profile object (not just partial) ensures correct behavior. Always spread the full profile with overrides.

    **`toggleSection(slug: string)`:**
    - Guard: if no `activeBusiness`, return early.
    - Compute new enabledSections: if slug is in current array, remove it; if not, add it.
    - Optimistic local update: same pattern as updateProfile but updating `enabledSections`.
    - Firestore update: call `updateBusiness(activeBusiness.id, { enabledSections: newSections })`.
    - The sidebar already filters by `activeBusiness.enabledSections` via `filteredBusinessPlanItems` in app-sidebar.tsx, so this will work immediately.

    **Return both methods** from the hook alongside existing methods.

    Do NOT add debouncing here — the header bar component will handle debouncing for profile fields. `toggleSection` is a discrete action (toggle on/off) that should save immediately.
  </action>
  <verify>Run `npx tsc --noEmit` — no TypeScript errors. The hook exports updateProfile and toggleSection.</verify>
  <done>
    - useBusinesses returns updateProfile and toggleSection
    - Both methods optimistically update businessListAtom
    - Both methods persist to Firestore via updateBusiness
    - No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Add shadcn Switch and Collapsible UI primitives</name>
  <files>
    src/components/ui/switch.tsx
    src/components/ui/collapsible.tsx
  </files>
  <action>
    Install the two shadcn/ui primitives needed for the BusinessHeaderBar:

    **Switch** (for section toggles):
    Run `npx shadcn@latest add switch` — this installs @radix-ui/react-switch and creates src/components/ui/switch.tsx.

    If the CLI is not available or fails, manually create the component:
    - Install: `npm install @radix-ui/react-switch`
    - Create `src/components/ui/switch.tsx` following the shadcn Switch pattern:
      - Import `Root, Thumb` from `@radix-ui/react-switch`
      - Export `Switch` component with standard shadcn styling (h-5 w-9, rounded-full, thumb translates on checked)
      - Use `cn()` utility for className merging
      - Forward ref

    **Collapsible** (for expandable header bar):
    Run `npx shadcn@latest add collapsible` — this installs @radix-ui/react-collapsible and creates src/components/ui/collapsible.tsx.

    If the CLI fails, manually create:
    - Install: `npm install @radix-ui/react-collapsible`
    - Create `src/components/ui/collapsible.tsx` exporting `Collapsible`, `CollapsibleTrigger`, `CollapsibleContent` from the Radix primitive.

    Verify both components import and type-check correctly.
  </action>
  <verify>Run `npx tsc --noEmit` — no errors. Both components exist at expected paths. Run `ls src/components/ui/switch.tsx src/components/ui/collapsible.tsx` to confirm.</verify>
  <done>
    - src/components/ui/switch.tsx exists with working Switch component
    - src/components/ui/collapsible.tsx exists with Collapsible, CollapsibleTrigger, CollapsibleContent exports
    - No TypeScript errors
  </done>
</task>
</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` succeeds
- [ ] useBusinesses hook exports updateProfile and toggleSection
- [ ] Switch and Collapsible UI components exist
- [ ] No regressions in existing functionality
</verification>

<success_criteria>
- useBusinesses hook has updateProfile and toggleSection methods
- Both methods do optimistic local updates + Firestore persistence
- shadcn Switch and Collapsible primitives installed and available
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/05-business-profile-section-config/05-01-SUMMARY.md`
</output>
