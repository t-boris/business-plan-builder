---
phase: 05-business-profile-section-config
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/components/business-header-bar.tsx
  - src/app/layout.tsx
autonomous: true
---

<objective>
Create the BusinessHeaderBar component and integrate it into the DashboardLayout so it appears on every business-scoped page.

Purpose: Give users a lightweight, always-accessible way to edit business profile and toggle sections on/off — the core deliverable of Phase 5.

Output: Collapsible header bar on every page with inline profile editing and section toggles.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/05-business-profile-section-config/05-CONTEXT.md
@.planning/phases/05-business-profile-section-config/05-01-SUMMARY.md

@src/hooks/use-businesses.ts
@src/app/layout.tsx
@src/components/app-sidebar.tsx
@src/lib/constants.ts
@src/lib/business-templates.ts
@src/types/business.ts
@src/components/ui/switch.tsx
@src/components/ui/collapsible.tsx
@src/components/ui/input.tsx
@src/components/ui/select.tsx
@src/components/ui/textarea.tsx
</context>

<tasks>
<task type="auto">
  <name>Task 1: Create BusinessHeaderBar component</name>
  <files>
    src/components/business-header-bar.tsx
  </files>
  <action>
    Create a new component `BusinessHeaderBar` at `src/components/business-header-bar.tsx`.

    **Layout — Collapsed state (default):**
    - A slim bar (h-10 or similar) showing:
      - Business name (text, left-aligned)
      - A subtle expand button (ChevronDown icon from lucide-react)
    - Styled with a bottom border to separate from content below
    - Use `Collapsible` + `CollapsibleTrigger` from `@/components/ui/collapsible`

    **Layout — Expanded state:**
    - Use `CollapsibleContent` to show the expanded panel
    - Two columns on desktop (md: breakpoint), single column on mobile:
      - **Left column: Profile fields**
        - Business name — `<Input>` from `@/components/ui/input`
        - Business type — `<Select>` from `@/components/ui/select` with options from `BUSINESS_TYPE_TEMPLATES` (7 types)
        - Industry — `<Input>` (free text, placeholder: "e.g., Technology, Healthcare, Food & Beverage")
        - Location — `<Input>` (free text, placeholder: "e.g., New York, NY")
        - Description — `<Textarea>` from `@/components/ui/textarea` (2-3 rows, placeholder: "Brief description of your business")
      - **Right column: Section toggles**
        - Header: "Sections" with a small description "Toggle sections for this business"
        - 9 rows, one per section from `SECTION_SLUGS` / `SECTION_LABELS` (import from `@/lib/constants`)
        - Each row: section label + `<Switch>` from `@/components/ui/switch`
        - Switch is checked if the slug is in `activeBusiness.enabledSections`
        - On toggle: call `toggleSection(slug)` from `useBusinesses()`

    **Data binding:**
    - Read initial values from `activeBusiness.profile` via `useBusinesses().activeBusiness`
    - Use local state for profile fields (controlled inputs), initialized from `activeBusiness.profile`
    - Reset local state when `activeBusiness` changes (useEffect with activeBusiness.id dependency)
    - **Debounced auto-save for profile fields:** Use a `useEffect` with a 500ms debounce timer. When local state differs from activeBusiness.profile, call `updateProfile(localFields)` after debounce.
      - Pattern: `useEffect(() => { const timer = setTimeout(() => updateProfile(diff), 500); return () => clearTimeout(timer); }, [localName, localType, localIndustry, localLocation, localDescription])`
      - Only call updateProfile if at least one field actually changed (compare with activeBusiness.profile).
    - Section toggles do NOT need debouncing — they call `toggleSection(slug)` immediately on toggle.

    **Styling:**
    - Use existing Tailwind classes consistent with the app's design system
    - Background: `bg-background` or `bg-muted/30` — subtle, not attention-grabbing
    - Border: `border-b` bottom border when collapsed, full border when expanded
    - Labels: `text-sm font-medium` for field labels, `text-xs text-muted-foreground` for descriptions
    - Inputs: use the existing shadcn Input/Textarea/Select styling — they already have consistent styling
    - Smooth open/close with Radix Collapsible's built-in animation (CSS `data-[state=open]` / `data-[state=closed]`)

    **Edge cases:**
    - If `activeBusiness` is null, render nothing (return null)
    - The ChevronDown icon should rotate when expanded (use `transition-transform` + `data-[state=open]:rotate-180`)
    - Keep the component self-contained — it imports useBusinesses and reads/writes through the hook

    Do NOT add any other fields beyond name, type, industry, location, description. No logo, no branding, no financial metadata (per CONTEXT.md).
    Do NOT make sections reorderable — fixed order per CONTEXT.md.
  </action>
  <verify>Run `npx tsc --noEmit` — no TypeScript errors. Component exports BusinessHeaderBar.</verify>
  <done>
    - BusinessHeaderBar component renders collapsed bar with business name + expand button
    - Expanded state shows profile fields (name, type, industry, location, description) + 9 section toggles
    - Profile fields debounce-save via updateProfile
    - Section toggles save immediately via toggleSection
    - Component handles null activeBusiness gracefully
    - Responsive layout (2 columns desktop, 1 column mobile)
    - No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate BusinessHeaderBar into DashboardLayout</name>
  <files>
    src/app/layout.tsx
  </files>
  <action>
    Modify `DashboardLayout` in `src/app/layout.tsx` to render `BusinessHeaderBar` between the existing header (breadcrumbs) and the content area (Outlet).

    **Placement:**
    ```
    <SidebarInset>
      <header>  {/* existing breadcrumb header — keep unchanged */}
        ...
      </header>
      <BusinessHeaderBar />   {/* NEW — between header and content */}
      <div className="flex-1 p-6">
        <Outlet />
      </div>
    </SidebarInset>
    ```

    **Import:**
    Add `import { BusinessHeaderBar } from "@/components/business-header-bar";` to the imports.

    That's it — the BusinessHeaderBar reads from Jotai atoms internally, no props needed.

    **Verify the integration works end-to-end:**
    - The header bar should be visible on every business-scoped page (dashboard, sections, scenarios, export)
    - Editing the business name in the header bar should update the sidebar header (which reads from activeBusinessAtom) and the breadcrumb (which also reads activeBusinessAtom) — both derive from businessListAtom which is optimistically updated by updateProfile
    - Toggling a section off should immediately remove it from the sidebar nav (filteredBusinessPlanItems in app-sidebar.tsx already filters by enabledSections)
  </action>
  <verify>Run `npx tsc --noEmit` — no TypeScript errors. BusinessHeaderBar is rendered inside DashboardLayout.</verify>
  <done>
    - BusinessHeaderBar renders between breadcrumb header and page content
    - Visible on all business-scoped pages
    - Profile edits reflect in sidebar header and breadcrumbs
    - Section toggles reflect in sidebar nav immediately
    - No TypeScript errors
  </done>
</task>
</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` succeeds
- [ ] BusinessHeaderBar renders on all business-scoped pages
- [ ] Collapsed state shows business name + expand button
- [ ] Expanded state shows 5 profile fields + 9 section toggles
- [ ] Profile fields have debounced auto-save (changes saved to Firestore)
- [ ] Section toggles save immediately and sidebar updates
- [ ] No regressions in existing layout or navigation
</verification>

<success_criteria>
- Compact header bar visible on every business-scoped page
- Collapsed shows business name, expanded shows full editor
- Profile editing saves to Firestore with debounced auto-save
- Section toggling updates sidebar navigation immediately
- Data preserved when toggling sections off
- Responsive layout (2 columns desktop, single column mobile)
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/05-business-profile-section-config/05-02-SUMMARY.md`
</output>
