---
phase: 04-strip-hardcoded-content
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/scenario.ts
  - src/lib/constants.ts
  - src/store/scenario-atoms.ts
  - src/store/derived-atoms.ts
  - src/features/scenarios/scenario-controls.tsx
  - src/features/scenarios/scenario-comparison.tsx
  - src/lib/ai/system-prompt.ts
  - src/lib/ai/context-builder.ts
  - src/lib/ai/section-prompts.ts
autonomous: true
---

<objective>
Genericize core types, constants, scenario engine, and AI layer by removing all Fun Box-specific variable names, default values, and hardcoded business content.

Purpose: Strip the foundation files so Wave 2 plans can reference generic types and constants when cleaning section components and remaining files.

Output: Generic scenario variable names (priceTier1/2/3, staffCount, costPerUnit), zeroed-out default values, and business-context-aware AI prompts with no Fun Box references.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/04-strip-hardcoded-content/04-CONTEXT.md

@src/types/scenario.ts
@src/lib/constants.ts
@src/store/scenario-atoms.ts
@src/store/derived-atoms.ts
@src/features/scenarios/scenario-controls.tsx
@src/features/scenarios/scenario-comparison.tsx
@src/lib/ai/system-prompt.ts
@src/lib/ai/context-builder.ts
@src/lib/ai/section-prompts.ts
</context>

<tasks>
<task type="auto">
  <name>Task 1: Rename scenario variables and clean constants</name>
  <files>
    src/types/scenario.ts
    src/lib/constants.ts
    src/store/scenario-atoms.ts
    src/store/derived-atoms.ts
  </files>
  <action>
    **Rename scenario variable fields across all 4 tightly-coupled files:**

    Field renames in ScenarioVariables interface (src/types/scenario.ts):
    - priceStarter → priceTier1
    - priceExplorer → priceTier2
    - priceVIP → priceTier3
    - crewCount → staffCount
    - costPerEvent → costPerUnit
    - Keep all other fields unchanged (monthlyLeads, conversionRate, cacPerLead, monthlyAdBudgetMeta, monthlyAdBudgetGoogle, bookingsPerMonth)

    In src/lib/constants.ts:
    - Rename fields in DEFAULT_SCENARIO_VARIABLES to match new names. Set ALL values to 0 (they will be populated per-business later).
    - REMOVE these exports entirely (they contain Fun Box data): DEFAULT_PACKAGES, DEFAULT_MARKETING_CHANNELS, DEFAULT_KPI_TARGETS, CREW_HOURLY_RATE, AVG_HOURS_PER_EVENT.
    - KEEP MONTHLY_FIXED_COSTS but set to 0 (it's used by derived-atoms formula; Phase 7 will make it dynamic).
    - KEEP SECTION_SLUGS and SECTION_LABELS — these are generic.

    In src/store/scenario-atoms.ts:
    - Rename all atom variables to match new field names: priceStarterAtom → priceTier1Atom, priceExplorerAtom → priceTier2Atom, priceVIPAtom → priceTier3Atom, crewCountAtom → staffCountAtom, costPerEventAtom → costPerUnitAtom.
    - Update snapshotScenarioAtom, loadScenarioAtom, resetToDefaultsAtom to use new field/atom names.
    - Keep scenarioNameAtom, scenarioSyncReadyAtom, currentScenarioIdAtom, scenarioListAtom unchanged.

    In src/store/derived-atoms.ts:
    - Update imports to use new atom names.
    - In computeDerivedMetrics function: update field references (v.priceTier1, v.priceTier2, v.priceTier3, v.costPerUnit).
    - avgCheck formula stays the same: (priceTier1 + priceTier2 + priceTier3) / 3.
    - Update avgCheckAtom, monthlyCostsAtom to use new atom names.
    - MONTHLY_FIXED_COSTS import stays (value is now 0 but formula is preserved).

    Do NOT rename the monthlyLeads/conversionRate/cacPerLead/monthlyAdBudget* fields — they are already generic.
    Do NOT change any formulas — only rename references.
    Do NOT remove DerivedMetrics interface from types/scenario.ts — it's generic.
  </action>
  <verify>Run `npx tsc --noEmit` — no TypeScript errors from the rename cascade.</verify>
  <done>
    - ScenarioVariables uses priceTier1/2/3, staffCount, costPerUnit
    - DEFAULT_SCENARIO_VARIABLES has all values set to 0
    - DEFAULT_PACKAGES, DEFAULT_MARKETING_CHANNELS, DEFAULT_KPI_TARGETS, CREW_HOURLY_RATE, AVG_HOURS_PER_EVENT removed from constants.ts
    - All atom names in scenario-atoms.ts and derived-atoms.ts use new names
    - TypeScript compiles (excluding downstream consumers that will be fixed in Task 2 and Wave 2)
  </done>
</task>

<task type="auto">
  <name>Task 2: Clean scenario UI controls and comparison</name>
  <files>
    src/features/scenarios/scenario-controls.tsx
    src/features/scenarios/scenario-comparison.tsx
  </files>
  <action>
    In src/features/scenarios/scenario-controls.tsx:
    - Update imports to use new atom names (priceTier1Atom, priceTier2Atom, priceTier3Atom, staffCountAtom, costPerUnitAtom).
    - Change UI labels from "Ocean Starter" → "Price Tier 1", "Ocean Explorer" → "Price Tier 2", "Ocean VIP" → "Price Tier 3".
    - Change "Crew Count" → "Staff Count", "Cost per Event" → "Cost per Unit".
    - Update all useAtom destructuring to use new names.

    In src/features/scenarios/scenario-comparison.tsx:
    - **CRITICAL FIX**: This file imports from `@/lib/firestore.ts` which was DELETED in Phase 3. Fix the import to use `listScenarioData` from `@/lib/business-firestore.ts`.
    - Replace hardcoded `const PLAN_ID = 'default'` with proper business-scoped call: the component needs access to activeBusinessIdAtom (import from business-atoms, use useAtomValue).
    - Update the `listScenarios(PLAN_ID)` call to `listScenarioData(businessId)` with null guard.
    - Update VARIABLE_ROWS to use new field names and labels:
      - 'priceStarter' → 'priceTier1', label 'Price Tier 1'
      - 'priceExplorer' → 'priceTier2', label 'Price Tier 2'
      - 'priceVIP' → 'priceTier3', label 'Price Tier 3'
      - 'crewCount' → 'staffCount', label 'Staff Count'
      - 'costPerEvent' → 'costPerUnit', label 'Cost per Unit'
    - Keep METRIC_ROWS unchanged (they reference ComputedMetrics which uses generic names).
  </action>
  <verify>Run `npx tsc --noEmit` — no TypeScript errors in scenario features.</verify>
  <done>
    - scenario-controls.tsx shows generic tier labels, not Fun Box package names
    - scenario-comparison.tsx imports from business-firestore.ts, uses activeBusinessIdAtom
    - No hardcoded PLAN_ID = 'default' remains
    - All variable references use new names
  </done>
</task>

<task type="auto">
  <name>Task 3: Genericize AI layer</name>
  <files>
    src/lib/ai/system-prompt.ts
    src/lib/ai/context-builder.ts
    src/lib/ai/section-prompts.ts
  </files>
  <action>
    In src/lib/ai/system-prompt.ts:
    - Replace the entire hardcoded Fun Box system instruction with a generic one.
    - New content: "You are a business plan writing assistant. ROLE: Expert business plan writer. TONE: Professional but approachable, data-driven, concise, actionable. CONSTRAINTS: Never invent financial numbers — use only provided context. When data is missing, say 'Data needed:'. All monetary values in USD. OUTPUT FORMAT: Return structured JSON matching the provided schema. Use markdown formatting in text fields. Keep text fields under 500 words."
    - Remove ALL Fun Box references: Miami, packages, target market, pricing.

    In src/lib/ai/context-builder.ts:
    - The `buildBusinessOverview()` function currently returns hardcoded Fun Box content. Change it to return a generic placeholder: "BUSINESS: [Not configured — business profile will be set in Phase 8]\nPACKAGES: See product-service section data\nTARGETS: See scenario metrics".
    - Note: Phase 8 (Business-Aware AI) will make this truly dynamic from business profile. For now, just remove the Fun Box hardcoding.
    - `buildScenarioContext()` and `buildSectionContext()` are already generic — leave unchanged.
    - `buildPrompt()` is already generic — leave unchanged.

    In src/lib/ai/section-prompts.ts:
    - Replace ALL 'generate' prompts with generic versions. Remove every reference to Fun Box, Miami, ocean, jellyfish, specific packages, specific pricing, Miami-Dade data.
    - Generic generate prompts pattern: "Generate [section type] based on the business context provided. Include [list of expected fields from the Zod schema]."
    - For 'improve' and 'expand' prompts: these are already mostly generic ("Improve the existing..."). Remove any that mention Miami, Fun Box, or specific business details.
    - Specific changes per section:
      - executive-summary generate: Already generic enough, keep as-is.
      - market-analysis generate: Remove "for Fun Box", "Miami mobile kids entertainment", "Miami-Dade data: population ~2.7M, 75.3% non-English speakers". Replace with: "Generate market analysis for the business. Include target demographic, market size estimate (TAM/SAM/SOM), competitor analysis (3-5 competitors), and demographics. Use the business context and location data provided."
      - product-service generate: Remove "for Fun Box. Include three packages (Ocean Starter $800, Ocean Explorer $980, Ocean VIP $1,200)". Replace with: "Generate product and service descriptions. Include packages with pricing, duration, max participants, includes list, and descriptions. Suggest 3-5 add-ons with prices."
      - marketing-strategy generate: Remove "for Fun Box. Include channels (Meta Ads, Google Ads, Organic Social, Partnerships) with budgets". Replace with: "Generate marketing strategy. Include marketing channels with budgets, expected leads, CAC, descriptions, and tactics. Add promotional offers and landing page description."
      - operations generate: Remove "for Fun Box" and all Miami-specific cost ranges. Replace with: "Generate operations plan. Include staff/crew (roles, hourly rates, counts), hoursPerEvent, capacity limits, travel radius, equipment, safety protocols, and full cost breakdown with realistic estimates for the business location."
      - operations improve: Remove "for Miami market". Replace with "for the business's market".
      - financial-projections expand: Remove "for Miami market". Replace with "for the business's market".
      - risks-due-diligence generate: Remove entire Fun Box-specific prompt (Miami-Dade regulations, Jellyfish Museum, FMCSA, FTSA, borax/slime). Replace with: "Generate investor-grade risk assessment and due diligence for the business. Include risks with categories (regulatory/operational/financial/legal/safety/dependency/capacity/market) and severity levels. Include investment verdict and due diligence checklist based on business context."
      - kpis-metrics generate: Remove "for Fun Box". Replace with: "Generate KPI targets based on the business context."
      - launch-plan generate: Remove "for Fun Box with 3-4 stages: Preparation (Jan-Feb 2026)..." etc. Replace with: "Generate a launch plan with 3-4 stages. Each stage should have 4-6 tasks with status 'pending'. Include specific, actionable tasks relevant to the business."
    - Keep the Zod schemas unchanged — they define the data structure, not business content.
    - Keep MarketingChannelSchema z.enum(['meta-ads', 'google-ads', 'organic-social', 'partnerships']) for now — Phase 7 will make channels dynamic.
    - Keep CostBreakdownSchema field descriptions — they describe what each field IS, not Fun Box content. Remove the ".describe('Cost of craft/slime materials per child')" and replace with generic: ".describe('Cost of supplies/materials per participant')". Same for museumTicketPrice → ".describe('Venue/ticket cost per person')".
  </action>
  <verify>Run `npx tsc --noEmit` — no TypeScript errors in AI layer. Grep for "Fun Box|Miami|Ocean|Jellyfish" in src/lib/ai/ returns no matches.</verify>
  <done>
    - system-prompt.ts contains zero Fun Box/Miami references
    - context-builder.ts returns generic placeholder
    - All 9 section prompts in section-prompts.ts are generic
    - Zod schemas preserved (structure unchanged)
    - No TypeScript errors
  </done>
</task>
</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` succeeds (may have errors from downstream consumers — those are fixed in 04-02 and 04-03)
- [ ] `grep -ri "fun.box\|funbox" src/types/scenario.ts src/lib/constants.ts src/store/ src/lib/ai/ src/features/scenarios/` returns no matches
- [ ] `grep -ri "ocean\|jellyfish\|miami" src/types/scenario.ts src/lib/constants.ts src/store/ src/lib/ai/ src/features/scenarios/` returns no matches
</verification>

<success_criteria>
- ScenarioVariables type uses generic field names (priceTier1/2/3, staffCount, costPerUnit)
- DEFAULT_SCENARIO_VARIABLES has all zeroed defaults
- Fun Box-specific constant exports removed (DEFAULT_PACKAGES, DEFAULT_MARKETING_CHANNELS, DEFAULT_KPI_TARGETS)
- All scenario atom names are generic
- Scenario controls show generic tier labels
- Scenario comparison uses business-scoped data (not hardcoded PLAN_ID)
- AI system prompt, context builder, and all 9 section prompts contain zero Fun Box content
</success_criteria>

<output>
After completion, create `.planning/phases/04-strip-hardcoded-content/04-01-SUMMARY.md`
</output>
