---
phase: 23-export-language-translation
plan: 02
type: execute
wave: 2
depends_on: ["23-01"]
files_modified: [src/features/export/index.tsx, src/features/export/pdf/generatePdf.ts, src/features/export/pdf/BusinessPlanDocument.tsx]
autonomous: false
---

<objective>
Add a language selector to the PDF export tab and wire translation into the PDF generation flow. When a non-source language is selected, all section text content is translated via AI before the PDF is rendered.

Purpose: Let users download a fully translated PDF of their business plan in any major language.
Output: Language dropdown in Export tab, translated PDF generation, updated filename with language code.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/23-export-language-translation/23-01-SUMMARY.md

@src/features/export/index.tsx
@src/features/export/pdf/generatePdf.ts
@src/features/export/pdf/BusinessPlanDocument.tsx
@src/lib/ai/translate-client.ts
@src/lib/constants.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add language selector and translation logic to Export component</name>
  <files>src/features/export/index.tsx, src/features/export/pdf/generatePdf.ts, src/features/export/pdf/BusinessPlanDocument.tsx</files>
  <action>
**1. Language selector UI** (in `src/features/export/index.tsx`):

Add a language selector dropdown in the PDF export tab, between the "Generated on" card and the "Download PDF" button. Use the existing shadcn Select component (`@/components/ui/select`).

Supported languages list (as a const array at module level):
```ts
const EXPORT_LANGUAGES = [
  { code: 'en', label: 'English (Original)' },
  { code: 'es', label: 'Spanish' },
  { code: 'fr', label: 'French' },
  { code: 'de', label: 'German' },
  { code: 'pt', label: 'Portuguese' },
  { code: 'it', label: 'Italian' },
  { code: 'ru', label: 'Russian' },
  { code: 'zh', label: 'Chinese' },
  { code: 'ja', label: 'Japanese' },
  { code: 'ko', label: 'Korean' },
  { code: 'ar', label: 'Arabic' },
  { code: 'hi', label: 'Hindi' },
  { code: 'uk', label: 'Ukrainian' },
] as const;
```

Add state: `const [exportLanguage, setExportLanguage] = useState('en');`

Render a language selector card similar to the existing "Active scenario" and "Generated on" cards:
```
<div className="flex items-center justify-between rounded-lg border p-3">
  <div>
    <p className="text-sm font-medium">Export language</p>
    <p className="text-xs text-muted-foreground">Translate content before generating PDF</p>
  </div>
  <Select value={exportLanguage} onValueChange={setExportLanguage}>
    ...SelectTrigger + SelectContent with EXPORT_LANGUAGES items
  </Select>
</div>
```

**2. Translation in handleDownloadPdf** (in `src/features/export/index.tsx`):

When `exportLanguage !== 'en'`, translate section texts before calling `generateBusinessPlanPdf`.

Add a helper function `translateAllSections` that:
- Extracts all translatable text fields from each section into a flat `Record<string, string>` with namespaced keys (e.g. `exec.summary`, `exec.mission`, `exec.vision`, `market.marketNarrative`, etc.)
- Calls `translateTexts()` from `@/lib/ai/translate-client` with the batch
- Since the batch might be large, split into chunks of ~20 fields per call to avoid token limits
- Merges translated values back into cloned section objects
- Returns the translated sections object (same shape as the original)

Fields to translate per section (only string/text fields, not numbers/booleans/arrays-of-numbers):
- **execSummary**: summary, mission, vision, keyHighlights (array of strings)
- **marketAnalysis**: marketNarrative, competitors[].name/strengths/weaknesses, acquisitionFunnel[].label/description, customMetrics[].name
- **productService**: overview, offerings[].name/description, addOns[].name/description
- **marketingStrategy**: channels[].name/description, landingPage.headline/subheadline/cta
- **operations**: workforce[].role, costItems[].category, equipment[].name/description, safetyProtocols[].protocol/description, operationalMetrics[].name, capacity.outputUnitLabel
- **risks**: risks[].name/description/mitigation, complianceItems[].requirement/status/notes, investmentVerdict.summary/strengths/weaknesses/conditions (these can be strings or arrays of strings)
- **kpis**: (mostly numeric — skip translation)
- **launchPlan**: stages[].name/description, stages[].tasks[].name
- **growthTimeline**: events[].label/description
- **financials**: (mostly numeric — skip translation)

Update the button text when translating: "Translating & generating PDF..." instead of "Generating PDF..."

Update filename to include language: `${sanitizedName}-business-plan-${exportLanguage}.pdf` (only when not English).

**3. Pass language to PDF for section titles** (in generatePdf.ts and BusinessPlanDocument.tsx):

Add `language?: string` to `GeneratePdfParams` interface.

In `BusinessPlanDocument`, when `language` is provided and not 'en':
- Add a small subtitle under the cover page title showing the language, e.g. "(Translated to Spanish)"
- The section titles (Executive Summary, Market Analysis, etc.) and subsection titles (Summary, Mission, Vision, etc.) are hardcoded in the component. For the translation feature, translate these static labels in the same batch — add them as extra keys in the translation batch (e.g. `label.executive-summary`, `label.summary`, etc.) and use the translated versions when rendering.

Keep it simple — do NOT add a full i18n framework. Just pass the translated labels through the existing props/params.
  </action>
  <verify>npx vite build — compiles without errors; npx vitest run — tests pass</verify>
  <done>Language selector appears in PDF export tab. Selecting a non-English language triggers AI translation of all text content before PDF generation. PDF renders with translated content and translated section/subsection titles. Filename includes language code.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>PDF export with language translation — language selector dropdown and AI-powered translation of all business plan content before PDF generation</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Navigate to any business → Export tab → PDF tab
    3. Verify language selector dropdown appears between "Generated on" and "Download PDF" button
    4. Select "English (Original)" → Download PDF → verify it works as before (no translation)
    5. Select "Spanish" → Download PDF → verify:
       - Button shows "Translating & generating PDF..."
       - PDF downloads with "-es" suffix in filename
       - PDF content is in Spanish (section titles, descriptions, narrative text)
       - Numbers, currency, charts remain unchanged
       - Markdown formatting preserved (bold, italic, lists)
    6. Try another language (e.g. Russian, French) → verify translation works
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx vite build` succeeds
- [ ] `npx vitest run` — all tests pass
- [ ] Language selector renders in Export PDF tab
- [ ] English export works unchanged
- [ ] Non-English export translates content and generates PDF
</verification>

<success_criteria>

- Language selector with 13+ languages in Export PDF tab
- Selecting non-English language translates all text fields via AI
- PDF renders with translated content including section/subsection titles
- Filename includes language code for non-English exports
- English export unchanged (no translation call)
- All builds and tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/23-export-language-translation/23-02-SUMMARY.md`
</output>
