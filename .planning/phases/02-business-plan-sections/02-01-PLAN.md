---
phase: 02-business-plan-sections
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [src/hooks/use-section.ts, src/features/sections/product-service/index.tsx, src/features/sections/market-analysis/index.tsx, src/features/sections/kpis-metrics/index.tsx]
autonomous: true
---

<objective>
Build the Product/Service, Market Analysis, and KPIs section UIs with editable forms, pre-populated data, and Firestore auto-save. Also create the shared `useSection` hook that all section pages will use for load/save.

Purpose: First batch of real section UIs — replaces placeholder pages with interactive forms. Creates the reusable data-loading pattern for all remaining sections.
Output: 3 working section pages with forms, pre-populated with Fun Box business data, auto-saving to Firestore.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-02-SUMMARY.md
@.planning/phases/01-foundation/01-03-SUMMARY.md

Key source files:
@src/types/plan.ts
@src/types/scenario.ts
@src/lib/constants.ts
@src/lib/firestore.ts
@src/store/plan-atoms.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useSection hook and Product/Service section UI</name>
  <files>src/hooks/use-section.ts, src/features/sections/product-service/index.tsx</files>
  <action>
  1. Create `src/hooks/use-section.ts` — shared hook for all section pages:
     - Takes `sectionSlug: SectionSlug` and `defaultData: T` as params
     - Uses `useState<T>(defaultData)` for local form state
     - On mount: calls `getSection(planId, sectionSlug)` from `@/lib/firestore` — if data exists in Firestore, set it as state; otherwise keep defaults
     - Uses `currentPlanIdAtom` from `@/store/plan-atoms` via `useAtomValue` for the plan ID
     - Provides a `updateField` function that updates local state AND debounce-saves to Firestore (500ms debounce using setTimeout/clearTimeout)
     - Returns `{ data, updateField, isLoading }` where isLoading is true during initial Firestore fetch
     - The debounce-save calls `saveSection(planId, sectionSlug, data)` with merge
     - Handle errors silently for now (Firestore may not be available without emulator — just use local state as fallback)

  2. Replace `src/features/sections/product-service/index.tsx` with full form UI:
     - Use `useSection<ProductService>('product-service', defaultProductService)` where defaultProductService uses `DEFAULT_PACKAGES` from constants
     - **Packages section:** Render each package as a Card with:
       - CardHeader: package name (editable Input) + price (number Input with $ prefix)
       - CardContent: duration (Input), maxParticipants (number Input), description (Textarea)
       - Includes list: each item as an Input in a list, with "Add" and remove buttons
     - **Add-ons section:** Simple table/list with name + price per row, "Add Add-on" button
     - Use shadcn/ui components: Card, Input, Textarea, Button, and the built-in Separator
     - Layout: section heading "Product & Service" at top, packages in a grid (1-3 cols responsive), add-ons below
     - Each field change calls `updateField` which triggers debounced Firestore save
     - Show a subtle "Saving..." indicator when save is in progress (optional, nice-to-have)

  **Use controlled inputs** — value from state, onChange updates state via updateField.
  **Do NOT** use a form library (react-hook-form, formik) — direct useState is simpler for this use case.
  **Do NOT** add validation yet — that comes with the what-if engine constraints in Phase 3.
  </action>
  <verify>npm run build succeeds, Product/Service page renders with 3 pre-populated packages</verify>
  <done>useSection hook created and working, Product/Service shows editable package cards with pre-populated data, changes are debounce-saved to Firestore</done>
</task>

<task type="auto">
  <name>Task 2: Build Market Analysis and KPIs section UIs</name>
  <files>src/features/sections/market-analysis/index.tsx, src/features/sections/kpis-metrics/index.tsx</files>
  <action>
  1. Replace `src/features/sections/market-analysis/index.tsx` with full form UI:
     - Use `useSection<MarketAnalysis>('market-analysis', defaultMarketAnalysis)`
     - Default data from PROJECT.md context:
       - targetDemographic: { ageRange: "28-50", location: "Miami Metro", radius: 25 }
       - marketSize: "Miami-Dade County — 2.7M population"
       - competitors: 2-3 entries from deep research (museum party competitors in $575-$1,250 range)
       - demographics: { population: 2700000, languages: ["English", "Spanish", "Haitian Creole"], income: "Median household $55,000" }
     - **Target Demographic card:** ageRange (Input), location (Input), radius (number Input with "miles" label)
     - **Market Size card:** single Textarea for market size description
     - **Competitors table:** using a simple table layout (not shadcn DataTable — overkill for 3-5 rows):
       - Columns: Name, Pricing, Strengths, Weaknesses
       - Each cell is an editable Input
       - "Add Competitor" button at bottom
       - Remove button per row
     - **Demographics card:** population (number Input), languages (comma-separated Input or tag-like list), income (Input)
     - Key insight from deep research: "75.3% of Miami-Dade speaks non-English at home — bilingual marketing opportunity" — display as an info badge/callout
     - Layout: heading, two-column grid for demographic + market size, full-width competitors table, demographics card

  2. Replace `src/features/sections/kpis-metrics/index.tsx` with full form UI:
     - Use `useSection<KpisMetrics>('kpis-metrics', defaultKpis)` where defaults come from DEFAULT_KPI_TARGETS
     - **Targets card:** Grid of number inputs:
       - Monthly Leads (number)
       - Conversion Rate (percentage — display as %, store as decimal 0-1)
       - Average Check ($ number)
       - CAC per Lead ($ number)
       - CAC per Booking ($ number)
       - Monthly Bookings (number)
     - **Actuals card (optional):** Same fields as targets but for tracking real numbers. Show as a separate card with a "Track Actuals" toggle (collapsed by default).
     - **Comparison view:** If both targets and actuals have values, show a simple side-by-side or inline comparison with color coding (green if actual >= target, red if below)
     - Pre-populated with DEFAULT_KPI_TARGETS for targets, actuals empty initially
     - Layout: heading, targets card (2-3 column grid of inputs), actuals card below

  **Pre-populate with real business data** from constants.ts and PROJECT.md.
  **Conversion rate display:** Show as percentage (e.g., "20%") but store as decimal (0.20). Convert on display/input.
  </action>
  <verify>npm run build succeeds. Market Analysis page shows demographic data, competitors table, and Miami research insights. KPIs page shows target inputs pre-populated with DEFAULT_KPI_TARGETS values.</verify>
  <done>Market Analysis shows editable competitor table + demographics with pre-populated Miami data, KPIs shows target/actual comparison grid with pre-populated targets</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without TypeScript errors
- [ ] Product/Service page shows 3 editable package cards with correct prices ($800, $980, $1200)
- [ ] Market Analysis page shows competitors table, demographics, and deep research insight
- [ ] KPIs page shows target inputs pre-populated with correct values (125 leads, 20% conversion, etc.)
- [ ] useSection hook loads defaults and debounce-saves changes
- [ ] All section pages use controlled inputs with onChange handlers
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- 3 section pages fully interactive with pre-populated data
- useSection hook created for reuse by remaining sections
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-business-plan-sections/02-01-SUMMARY.md`
</output>
