---
phase: 06-variable-library
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/variable-templates/saas.ts
  - src/lib/variable-templates/service.ts
  - src/lib/variable-templates/retail.ts
  - src/lib/variable-templates/restaurant.ts
  - src/lib/variable-templates/event.ts
  - src/lib/variable-templates/manufacturing.ts
  - src/lib/variable-templates/custom.ts
  - src/lib/variable-templates/index.ts
  - src/lib/business-templates.ts
autonomous: true
---

<objective>
Create variable template files for all 7 business types and wire them into the existing business template system.

Purpose: Each business type gets a curated set of input and computed variables that make the scenario engine immediately useful. SaaS gets MRR, churn, CAC. Restaurant gets covers, average check, food cost %. The right variables for the right business — smart defaults.

Output: 7 template files with VariableDefinition arrays, an index file exporting them all, and business-templates.ts updated with a `defaultVariables` getter.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/06-variable-library/06-RESEARCH.md
@.planning/phases/06-variable-library/06-CONTEXT.md

@src/types/business.ts
@src/lib/business-templates.ts
</context>

<tasks>
<task type="auto">
  <name>Task 1: Create SaaS, Service, Retail, and Restaurant variable templates</name>
  <files>
    src/lib/variable-templates/saas.ts
    src/lib/variable-templates/service.ts
    src/lib/variable-templates/retail.ts
    src/lib/variable-templates/restaurant.ts
  </files>
  <action>
    Create 4 template files. Each file exports a single `VariableDefinition[]` array. Import `inputVar`, `computedVar` from `./types` — BUT since Plan 06-01 creates types.ts in parallel, define local inline factory functions in each file instead (simple one-liners that construct VariableDefinition objects). This avoids a dependency on 06-01.

    **Actually — since types.ts is created by Plan 06-01 which runs in parallel, and the subagent won't have access to it yet, define the factory helpers INLINE in each template file as private helpers.** Each file should import `VariableDefinition` from `@/types/business` and define local `inputVar` and `computedVar` helpers.

    **Alternative approach (better):** Since both plans run in Wave 1, the subagent should create `src/lib/variable-templates/types.ts` itself if it doesn't exist yet, OR simply construct VariableDefinition objects directly without helpers. The simplest approach: construct objects directly with spread syntax.

    **Best approach: Construct VariableDefinition objects directly.** No helpers needed — the objects are simple and explicit.

    **src/lib/variable-templates/saas.ts:**
    Export `SAAS_VARIABLES: VariableDefinition[]` with these variables from RESEARCH.md:

    *Revenue inputs:*
    - monthlyPrice (currency, default 49, "Monthly Subscription Price")
    - numberOfCustomers (count, default 100, "Active Subscribers")
    - newCustomersPerMonth (count, default 20, "New Customers/Month")

    *Growth inputs:*
    - monthlyChurnRate (percent, default 0.05, "Monthly Churn Rate", step 0.01)
    - customerAcquisitionCost (currency, default 150, "Customer Acquisition Cost")

    *Cost inputs:*
    - grossMarginPercent (percent, default 0.80, "Gross Margin", step 0.01)
    - monthlyFixedCosts (currency, default 5000, "Monthly Fixed Costs")

    *Computed:*
    - mrr: `monthlyPrice * numberOfCustomers` (depends: monthlyPrice, numberOfCustomers)
    - arr: `mrr * 12`
    - monthlyChurnedCustomers: `numberOfCustomers * monthlyChurnRate`
    - netNewCustomers: `newCustomersPerMonth - monthlyChurnedCustomers`
    - ltv: `monthlyChurnRate > 0 ? monthlyPrice / monthlyChurnRate : monthlyPrice * 120`
    - ltvCacRatio: `customerAcquisitionCost > 0 ? ltv / customerAcquisitionCost : 0`
    - monthlyRevenue: `mrr` (alias for clarity)
    - monthlyCOGS: `mrr * (1 - grossMarginPercent)`
    - monthlyAcquisitionCost: `newCustomersPerMonth * customerAcquisitionCost`
    - monthlyCosts: `monthlyCOGS + monthlyAcquisitionCost + monthlyFixedCosts`
    - monthlyProfit: `monthlyRevenue - monthlyCosts`
    - profitMargin: `monthlyRevenue > 0 ? monthlyProfit / monthlyRevenue : 0`
    - annualRevenue: `monthlyRevenue * 12`
    - annualProfit: `monthlyProfit * 12`

    **src/lib/variable-templates/service.ts:**
    Export `SERVICE_VARIABLES: VariableDefinition[]` from RESEARCH.md:

    *Revenue inputs:* numberOfStaff (count, 5), billableHoursPerWeek (hours, 40), utilizationRate (percent, 0.75), averageHourlyRate (currency, 150)
    *Cost inputs:* monthlySalaryPerStaff (currency, 6000), monthlyOverhead (currency, 3000), monthlyMarketingBudget (currency, 1000)
    *Computed:* weeklyBillableHours, monthlyBillableHours, monthlyRevenue, totalSalaries, monthlyCosts, monthlyProfit, profitMargin, revenuePerEmployee, effectiveRate, annualRevenue, annualProfit

    Use exact formulas from RESEARCH.md variable_templates section.

    **src/lib/variable-templates/retail.ts:**
    Export `RETAIL_VARIABLES: VariableDefinition[]` from RESEARCH.md:

    *Revenue inputs:* monthlyFootTraffic (count, 3000), conversionRate (percent, 0.03), averageTransactionValue (currency, 45)
    *Cost inputs:* costOfGoodsPercent (percent, 0.50), staffCount (count, 3), averageHourlyWage (currency, 15), hoursPerWeek (hours, 35), monthlyRent (currency, 3000), monthlyMarketingBudget (currency, 500), monthlyOtherFixed (currency, 500)
    *Computed:* monthlyTransactions, monthlyRevenue, costOfGoods, grossProfit, monthlyLabor, monthlyCosts, monthlyProfit, profitMargin, grossMarginPercent, annualRevenue, annualProfit

    **src/lib/variable-templates/restaurant.ts:**
    Export `RESTAURANT_VARIABLES: VariableDefinition[]` from RESEARCH.md:

    *Revenue inputs:* numberOfSeats (count, 50), turnsPerDay (count, 2), averageCheck (currency, 35), daysOpenPerMonth (days, 26)
    *Cost inputs:* foodCostPercent (percent, 0.30), laborCostPercent (percent, 0.30), monthlyRent (currency, 5000), monthlyUtilities (currency, 1500), monthlyOtherFixed (currency, 1000)
    *Computed:* dailyCovers, monthlyCovers, monthlyRevenue, foodCost, laborCost, primeCost, primeCostPercent, monthlyFixedCosts, monthlyCosts, monthlyProfit, profitMargin, annualRevenue, annualProfit

    **For EVERY variable in EVERY template:**
    - `id`: camelCase identifier (e.g., `monthlyPrice`)
    - `label`: Human-readable (e.g., `"Monthly Subscription Price"`)
    - `type`: `"input"` or `"computed"`
    - `category`: One of `"revenue"`, `"costs"`, `"unitEconomics"`, `"growth"`, `"operations"`
    - `unit`: One of `"currency"`, `"percent"`, `"count"`, `"months"`, `"days"`, `"hours"`, `"ratio"`
    - `value`: Default value for inputs, `0` for computed
    - `defaultValue`: Same as value
    - `formula`: Only for computed variables
    - `dependsOn`: Only for computed variables — array of variable IDs referenced in formula
    - `description`: Brief description
    - `min`: 0 for most numeric fields (optional)
    - `step`: 0.01 for percents, 1 for counts (optional)

    **Critical: Percent convention.** All percent values stored as decimals (0.30 = 30%). Formulas use decimal form. UI will multiply by 100 for display (Phase 7 concern).
  </action>
  <verify>Run `npx tsc --noEmit` — no TypeScript errors. All 4 files export typed arrays. Verify each file has the correct number of variables matching RESEARCH.md.</verify>
  <done>
    - saas.ts: 7 input + 14 computed = 21 variables
    - service.ts: 7 input + 11 computed = 18 variables
    - retail.ts: 10 input + 11 computed = 21 variables
    - restaurant.ts: 9 input + 13 computed = 22 variables
    - All import VariableDefinition from @/types/business
    - All formulas match RESEARCH.md exactly
    - All percent values are decimals
    - No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Event, Manufacturing, Custom templates + index + wire to business-templates.ts</name>
  <files>
    src/lib/variable-templates/event.ts
    src/lib/variable-templates/manufacturing.ts
    src/lib/variable-templates/custom.ts
    src/lib/variable-templates/index.ts
    src/lib/business-templates.ts
  </files>
  <action>
    **Create 3 remaining template files:**

    **src/lib/variable-templates/event.ts:**
    Export `EVENT_VARIABLES: VariableDefinition[]` from RESEARCH.md:

    *Revenue inputs:* eventsPerMonth (count, 8), averageTicketPrice (currency, 50), averageAttendees (count, 100)
    *Cost inputs:* venueCostPerEvent (currency, 500), staffingCostPerEvent (currency, 800), suppliesCostPerEvent (currency, 300), monthlyMarketingBudget (currency, 1000), monthlyFixedCosts (currency, 3000)
    *Computed:* revenuePerEvent, monthlyRevenue, variableCostPerEvent, totalVariableCosts, profitPerEvent, monthlyCosts, monthlyProfit, profitMargin, breakEvenEvents, annualRevenue, annualProfit

    **src/lib/variable-templates/manufacturing.ts:**
    Export `MANUFACTURING_VARIABLES: VariableDefinition[]` from RESEARCH.md:

    *Revenue inputs:* monthlyProductionCapacity (count, 10000), capacityUtilization (percent, 0.80), sellingPricePerUnit (currency, 25)
    *Cost inputs:* rawMaterialCostPerUnit (currency, 8), directLaborCostPerUnit (currency, 5), overheadCostPerUnit (currency, 3), yieldRate (percent, 0.95), monthlyFixedCosts (currency, 15000)
    *Computed:* actualProduction, qualityUnits, totalMaterialCost, totalLaborCost, totalManufacturingOverhead, totalProductionCost, costPerUnit, monthlyRevenue, grossProfit, grossMarginPercent, monthlyCosts, monthlyProfit, profitMargin, annualRevenue, annualProfit

    **src/lib/variable-templates/custom.ts:**
    Export `CUSTOM_VARIABLES: VariableDefinition[]` — minimal starting set:

    *Revenue inputs:* monthlyRevenue (currency, 0, "Monthly Revenue")
    *Cost inputs:* monthlyCosts (currency, 0, "Monthly Costs")
    *Computed:* monthlyProfit (`monthlyRevenue - monthlyCosts`), profitMargin (`monthlyRevenue > 0 ? monthlyProfit / monthlyRevenue : 0`), annualRevenue (`monthlyRevenue * 12`), annualProfit (`monthlyProfit * 12`)

    **Create src/lib/variable-templates/index.ts:**
    - Re-export all 7 template arrays: SAAS_VARIABLES, SERVICE_VARIABLES, RETAIL_VARIABLES, RESTAURANT_VARIABLES, EVENT_VARIABLES, MANUFACTURING_VARIABLES, CUSTOM_VARIABLES
    - Export a lookup map:
      ```
      export const VARIABLE_TEMPLATES: Record<BusinessType, VariableDefinition[]> = {
        saas: SAAS_VARIABLES,
        service: SERVICE_VARIABLES,
        retail: RETAIL_VARIABLES,
        restaurant: RESTAURANT_VARIABLES,
        event: EVENT_VARIABLES,
        manufacturing: MANUFACTURING_VARIABLES,
        custom: CUSTOM_VARIABLES,
      };
      ```
    - Import `BusinessType` from `@/types`
    - Export a helper: `getDefaultVariables(type: BusinessType): Record<string, VariableDefinition>` that converts the array to a Record keyed by variable ID (same as `toVariableRecord` — just inline the reduce here since types.ts may or may not exist from the parallel plan)

    **Update src/lib/business-templates.ts:**
    - Import `getDefaultVariables` from `./variable-templates`
    - Add a `defaultVariables` getter to `BusinessTypeTemplate`:
      - **Option A:** Add `defaultVariables` as a property on each template object. But this is a lot of data to embed.
      - **Option B (better):** Export a standalone function `getTemplateVariables(type: BusinessType): Record<string, VariableDefinition>` that calls `getDefaultVariables(type)`. Keep the template objects lean.

    Choose Option B. Add the export:
    ```
    import { getDefaultVariables } from './variable-templates';
    export { getDefaultVariables as getTemplateVariables };
    ```

    This re-exports so consumers can get variables via business-templates.ts (the existing import point for template data).
  </action>
  <verify>Run `npx tsc --noEmit` — no TypeScript errors. Verify index.ts exports VARIABLE_TEMPLATES and getDefaultVariables. Verify business-templates.ts exports getTemplateVariables.</verify>
  <done>
    - event.ts: 8 input + 11 computed = 19 variables
    - manufacturing.ts: 8 input + 15 computed = 23 variables
    - custom.ts: 2 input + 4 computed = 6 variables
    - index.ts exports VARIABLE_TEMPLATES map and getDefaultVariables function
    - business-templates.ts exports getTemplateVariables
    - All 7 business types covered
    - No TypeScript errors
  </done>
</task>
</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` succeeds
- [ ] All 7 template files exist with correct variable counts
- [ ] index.ts exports VARIABLE_TEMPLATES and getDefaultVariables
- [ ] business-templates.ts exports getTemplateVariables
- [ ] Formulas use decimal percent values (0.30 not 30)
- [ ] All dependsOn arrays accurately reflect formula references
- [ ] No regressions in existing build
</verification>

<success_criteria>
- 7 business types have curated variable templates
- Variable counts match RESEARCH.md specifications
- All formulas are syntactically valid (for expr-eval)
- getDefaultVariables returns Record<string, VariableDefinition> keyed by variable ID
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/06-variable-library/06-02-SUMMARY.md`
</output>
