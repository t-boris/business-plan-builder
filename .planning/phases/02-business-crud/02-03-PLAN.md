---
phase: 02-business-crud
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified: [src/features/businesses/index.tsx, src/features/businesses/delete-business-dialog.tsx]
autonomous: true
---

<objective>
Build the business list page — the home screen of the app. Shows business cards with name, type, and completion status. Includes a friendly empty state with welcome message. Includes delete business dialog with type-to-confirm safety.

Purpose: This is the first thing users see when they open the app. It needs to feel clean, informative, and fast. The delete dialog provides GitHub-style safety for destructive operations.

Output: `src/features/businesses/index.tsx`, `src/features/businesses/delete-business-dialog.tsx`
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-business-crud/02-CONTEXT.md
@.planning/phases/02-business-crud/02-01-SUMMARY.md

@src/hooks/use-businesses.ts
@src/store/business-atoms.ts
@src/lib/business-templates.ts
@src/types/business.ts
@src/components/ui/card.tsx
@src/components/ui/button.tsx
@src/components/ui/input.tsx
@src/components/ui/skeleton.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create business list page with cards and empty state</name>
  <files>src/features/businesses/index.tsx</files>
  <action>
Create `src/features/businesses/index.tsx` — the main business list page.

**Three states to handle:**

1. **Loading state:** Show skeleton cards while businesses load.

2. **Empty state (no businesses):** Friendly welcome message:
   ```
   Welcome to Business Planner

   Create your first business plan to get started.
   Each business gets its own sections, scenarios, and financial projections.

   [Create Your First Business Plan] (primary button, links to /businesses/new)
   ```
   Center this vertically and horizontally. Keep it clean and inviting — not a sad empty table.

3. **Business list:** Grid of business cards.

**Business card design:**

Each card shows:
- Business name (bold, truncated if long)
- Business type badge (use the template name, e.g., "SaaS / Software")
- Brief description (truncated to 2 lines)
- Completion indicator: simple text like "3 of 9 sections" or a subtle progress bar
  - Completion = number of enabledSections (from business.enabledSections.length) — this is a placeholder metric. Real completion tracking (sections with data) comes in later phases.
- Last edited date (relative: "2 hours ago", "3 days ago" — format with simple helper)
- Delete button (small, muted, top-right corner — triggers delete dialog)

**Card interactions:**
- Click card → `switchBusiness(business.id)` + `navigate("/")` (sets active and goes to dashboard)
- Click delete button (with `e.stopPropagation()`) → opens delete dialog

**Layout:**
- Header: "Your Businesses" title + "New Business" button (links to /businesses/new)
- Grid: `grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4`
- Cards use shadcn Card component

**Lucide icons:** Import the same icon map pattern as create-business.tsx to show type icon on each card.

**Relative time helper:** Write a small inline helper function `formatRelativeTime(isoDate: string): string` that returns "just now", "X minutes ago", "X hours ago", "X days ago", "X months ago". No external library needed — simple Date.now() comparison.

**Component structure:**
```typescript
export function BusinessList() {
  const { businesses, isLoading, switchBusiness } = useBusinesses();
  const navigate = useNavigate();
  const [deleteTarget, setDeleteTarget] = useState<Business | null>(null);

  if (isLoading) return <LoadingSkeleton />;
  if (businesses.length === 0) return <EmptyState />;

  return (
    // Header + grid of cards + DeleteBusinessDialog
  );
}
```

**IMPORTANT:**
- Named export: `export function BusinessList()`
- Use `cn()` for conditional classes
- Use `Link` from `react-router` for navigation links
- Use `useNavigate` from `react-router` for programmatic navigation
- Import `useBusinesses` from `@/hooks/use-businesses`
- Use shadcn Card, Button, Skeleton components
- State for delete dialog: `deleteTarget: Business | null`
- Import and render `DeleteBusinessDialog` (created in Task 2)
  </action>
  <verify>npx tsc --noEmit passes with no errors</verify>
  <done>Business list renders loading/empty/list states. Cards show name, type, description, section count, relative time, delete button. Empty state has welcome message and create button.</done>
</task>

<task type="auto">
  <name>Task 2: Create delete business dialog with type-to-confirm</name>
  <files>src/features/businesses/delete-business-dialog.tsx</files>
  <action>
Create `src/features/businesses/delete-business-dialog.tsx` — a confirmation dialog where users must type the business name to confirm deletion (GitHub-style).

**First, add the Dialog shadcn component:**
Run `npx shadcn@latest add dialog --yes` to install the dialog primitive. This creates `src/components/ui/dialog.tsx`.

**Dialog component:**

```typescript
interface DeleteBusinessDialogProps {
  business: Business | null;
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onConfirm: () => void;
}

export function DeleteBusinessDialog({
  business, open, onOpenChange, onConfirm
}: DeleteBusinessDialogProps) {
  const [confirmText, setConfirmText] = useState("");
  const [isDeleting, setIsDeleting] = useState(false);

  const isMatch = confirmText === business?.profile.name;

  async function handleDelete() {
    if (!isMatch) return;
    setIsDeleting(true);
    try {
      await onConfirm();
      onOpenChange(false);
    } finally {
      setIsDeleting(false);
      setConfirmText("");
    }
  }

  // Reset on close
  // Use Dialog from shadcn
}
```

**Dialog content:**
```
Delete Business

This action cannot be undone. This will permanently delete the business
"[Business Name]" and all associated data.

To confirm, type "[business name]" below:

[Input field]

[Cancel] [Delete Business] (destructive variant, disabled until name matches)
```

**Styling:**
- Use shadcn Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter
- Delete button uses `variant="destructive"` (shadcn Button)
- Input uses shadcn Input
- Business name in the description is bold/highlighted
- Delete button is disabled until input matches exactly (case-sensitive)

**Reset state:** When dialog closes (onOpenChange false), reset confirmText and isDeleting.

**IMPORTANT:**
- Named export: `export function DeleteBusinessDialog()`
- The dialog does NOT call deleteBusiness itself — it calls onConfirm prop (parent handles the actual deletion via useBusinesses().removeBusiness)
- Use shadcn Dialog components (installed in this task)
  </action>
  <verify>npx tsc --noEmit passes with no errors. Verify dialog.tsx exists in src/components/ui/.</verify>
  <done>Delete dialog renders with type-to-confirm pattern. Button disabled until name matches. Calls onConfirm when confirmed. Resets on close.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes with zero errors
- [ ] `src/features/businesses/index.tsx` exports BusinessList component
- [ ] `src/features/businesses/delete-business-dialog.tsx` exports DeleteBusinessDialog
- [ ] `src/components/ui/dialog.tsx` exists (installed via shadcn)
- [ ] Business list handles loading, empty, and populated states
- [ ] Empty state shows welcome message and create button
- [ ] Delete dialog requires exact name match to enable delete button
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Business list shows cards with name, type, completion, relative time
- Empty state is welcoming with clear CTA
- Delete dialog uses type-to-confirm (GitHub-style)
- Dialog shadcn component installed
</success_criteria>

<output>
After completion, create `.planning/phases/02-business-crud/02-03-SUMMARY.md`
</output>
