---
phase: 02-business-crud
plan: 04
type: execute
wave: 2
depends_on: ["02-01"]
files_modified: [src/components/app-sidebar.tsx, src/app/layout.tsx]
autonomous: true
---

<objective>
Add a business switcher dropdown to the sidebar header and update the layout breadcrumbs to show the active business name.

Purpose: Users need to see which business they're working on and switch between businesses without navigating back to the list. The sidebar header currently shows hardcoded "Fun Box" — it should show the active business name with a dropdown to switch.

Output: Modified `src/components/app-sidebar.tsx`, modified `src/app/layout.tsx`
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-business-crud/02-CONTEXT.md
@.planning/phases/02-business-crud/02-01-SUMMARY.md

@src/components/app-sidebar.tsx
@src/app/layout.tsx
@src/store/business-atoms.ts
@src/hooks/use-businesses.ts
@src/lib/business-templates.ts
@src/components/ui/dropdown-menu.tsx
@src/components/ui/sidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add business switcher dropdown to sidebar header</name>
  <files>src/components/app-sidebar.tsx</files>
  <action>
Modify `src/components/app-sidebar.tsx` to replace the hardcoded "Fun Box" header with a business switcher dropdown.

**Current sidebar header (replace this):**
```tsx
<SidebarMenuButton size="lg" asChild>
  <Link to="/">
    <div className="bg-primary text-primary-foreground flex aspect-square size-8 items-center justify-center rounded-lg text-lg">
      F
    </div>
    <div className="grid flex-1 text-left text-sm leading-tight">
      <span className="truncate font-semibold">Fun Box</span>
      <span className="truncate text-xs">Business Planner</span>
    </div>
  </Link>
</SidebarMenuButton>
```

**Replace with a DropdownMenu business switcher:**

```tsx
<DropdownMenu>
  <DropdownMenuTrigger asChild>
    <SidebarMenuButton size="lg">
      <div className="bg-primary text-primary-foreground flex aspect-square size-8 items-center justify-center rounded-lg text-sm font-semibold">
        {activeBusiness?.profile.name?.[0]?.toUpperCase() ?? "?"}
      </div>
      <div className="grid flex-1 text-left text-sm leading-tight">
        <span className="truncate font-semibold">
          {activeBusiness?.profile.name ?? "Select Business"}
        </span>
        <span className="truncate text-xs text-muted-foreground">
          {activeBusiness ? templateName : "No business selected"}
        </span>
      </div>
      <ChevronsUpDown className="ml-auto size-4" />
    </SidebarMenuButton>
  </DropdownMenuTrigger>
  <DropdownMenuContent side="bottom" align="start" className="w-64">
    {businesses.map((business) => (
      <DropdownMenuItem
        key={business.id}
        onClick={() => switchBusiness(business.id)}
        className={cn(activeBusiness?.id === business.id && "bg-accent")}
      >
        <div className="flex items-center gap-2">
          <div className="flex size-6 shrink-0 items-center justify-center rounded bg-muted text-xs font-medium">
            {business.profile.name[0]?.toUpperCase() ?? "?"}
          </div>
          <div className="grid text-sm leading-tight">
            <span className="truncate font-medium">{business.profile.name}</span>
            <span className="truncate text-xs text-muted-foreground">{getTemplateName(business.profile.type)}</span>
          </div>
        </div>
      </DropdownMenuItem>
    ))}
    <DropdownMenuSeparator />
    <DropdownMenuItem asChild>
      <Link to="/businesses/new" className="flex items-center gap-2">
        <Plus className="size-4" />
        <span>New Business</span>
      </Link>
    </DropdownMenuItem>
    <DropdownMenuItem asChild>
      <Link to="/businesses" className="flex items-center gap-2">
        <LayoutList className="size-4" />
        <span>All Businesses</span>
      </Link>
    </DropdownMenuItem>
  </DropdownMenuContent>
</DropdownMenu>
```

**Helper function to get template display name:**
```typescript
function getTemplateName(type: BusinessType): string {
  const template = BUSINESS_TYPE_TEMPLATES.find((t) => t.type === type);
  return template?.name ?? "Business";
}
```

**New imports needed:**
- `useBusinesses` from `@/hooks/use-businesses`
- `BUSINESS_TYPE_TEMPLATES` from `@/lib/business-templates`
- `Plus`, `LayoutList` from `lucide-react`
- `BusinessType` type from `@/types`
- `cn` from `@/lib/utils` (if not already imported)

**Inside AppSidebar component, add:**
```typescript
const { businesses, activeBusiness, switchBusiness } = useBusinesses();
```

**Keep everything else in the sidebar unchanged** — the Overview, Business Plan, and Tools groups, the user footer, theme toggle, version number. Only replace the header SidebarMenuButton.

**When no active business:** Show "Select Business" / "No business selected" in the header. The dropdown still shows the list + links to create/view all.
  </action>
  <verify>npx tsc --noEmit passes with no errors</verify>
  <done>Sidebar header shows active business name + type with dropdown. Dropdown lists all businesses with switch action. Includes "New Business" and "All Businesses" links. Active business highlighted.</done>
</task>

<task type="auto">
  <name>Task 2: Update layout breadcrumbs for business context</name>
  <files>src/app/layout.tsx</files>
  <action>
Modify `src/app/layout.tsx` to include the active business name in the breadcrumb trail.

**Current breadcrumb:**
```
[Page Title]
```

**Updated breadcrumb when a business is active:**
```
[Business Name] / [Page Title]
```

**Updated breadcrumb when no business (on list/create pages):**
```
[Page Title]
```

**Changes to DashboardLayout:**

1. Import `useAtomValue` from `jotai` and `activeBusinessAtom` from `@/store/business-atoms`.
2. Get active business: `const activeBusiness = useAtomValue(activeBusinessAtom);`
3. Update breadcrumb to include business name when present:

```tsx
<Breadcrumb>
  <BreadcrumbList>
    {activeBusiness && (
      <>
        <BreadcrumbItem>
          <span className="text-muted-foreground">{activeBusiness.profile.name}</span>
        </BreadcrumbItem>
        <BreadcrumbSeparator />
      </>
    )}
    <BreadcrumbItem>
      <BreadcrumbPage>{pageTitle}</BreadcrumbPage>
    </BreadcrumbItem>
  </BreadcrumbList>
</Breadcrumb>
```

4. Import `BreadcrumbSeparator` from `@/components/ui/breadcrumb` (add to existing import).

**Also add route titles for new business pages:**
```typescript
const routeTitles: Record<string, string> = {
  "/businesses": "Your Businesses",
  "/businesses/new": "New Business",
  // ... keep all existing entries
};
```

**IMPORTANT:**
- Only modify the breadcrumb section and routeTitles map
- Keep all other layout structure unchanged (SidebarProvider, SidebarInset, Outlet, etc.)
- BreadcrumbSeparator renders a "/" between items by default in shadcn
  </action>
  <verify>npx tsc --noEmit passes with no errors</verify>
  <done>Breadcrumbs show "Business Name / Page Title" when a business is active. New route titles added for business list and create pages.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes with zero errors
- [ ] Sidebar header shows business switcher dropdown instead of hardcoded "Fun Box"
- [ ] Dropdown lists businesses with switch action
- [ ] Dropdown includes "New Business" and "All Businesses" links
- [ ] Breadcrumbs include active business name when present
- [ ] New route titles added for /businesses and /businesses/new
- [ ] No regressions to existing sidebar groups or footer
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No errors or warnings introduced
- Sidebar switcher replaces hardcoded branding with dynamic business name
- Business switching updates active business via hook
- Breadcrumbs contextually show business name
- All existing sidebar navigation preserved
</success_criteria>

<output>
After completion, create `.planning/phases/02-business-crud/02-04-SUMMARY.md`
</output>
