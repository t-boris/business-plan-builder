---
phase: 18-advanced-scenario-engine
plan: 03
type: execute
wave: 2
depends_on: ["18-01"]
files_modified:
  - src/features/scenarios/index.tsx
  - src/features/scenarios/assumptions-editor.tsx
autonomous: true
---

<objective>
Restructure the Scenario Editor page with tabbed navigation (Assumptions, Levers, Variants, Compare, Decision) and create the Assumptions editor component.

Purpose: Provide the UI shell for all v2 scenario features. Assumptions tab is the first new feature users interact with.
Output: Tabbed scenario page + working AssumptionsEditor component.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/18-advanced-scenario-engine/18-01-PLAN.md

@src/features/scenarios/index.tsx
@src/features/scenarios/scenario-manager.tsx
@src/features/scenarios/scenario-controls.tsx
@src/features/scenarios/scenario-comparison.tsx
@src/features/scenarios/scenario-dashboard.tsx
@src/types/scenario.ts
@src/store/scenario-atoms.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure scenario page with tabbed layout</name>
  <files>src/features/scenarios/index.tsx</files>
  <action>
Read the current `src/features/scenarios/index.tsx`. It has two tabs: "Editor" and "Compare" using shadcn Tabs component.

Replace with 5 tabs:
1. **Assumptions** — New tab for scenario assumptions (narrative + structured)
2. **Levers** — Renamed from "Editor", contains existing DynamicScenarioControls + ScenarioDashboard
3. **Variants** — New tab, placeholder content: `<div className="text-center text-muted-foreground py-12">Section variants — coming in Plan 18-04</div>`
4. **Compare** — Existing ScenarioComparison (move here as-is)
5. **Decision** — New tab, placeholder content: `<div className="text-center text-muted-foreground py-12">Decision matrix — coming in Plan 18-05</div>`

Keep the ScenarioManager in the page header (same position).

Add scenario status badge next to the scenario name in the header area. Read `scenarioStatusAtom` from `@/store/scenario-atoms`. Display as a small colored badge:
- `draft`: gray badge "Draft"
- `active`: green badge "Active"
- `archived`: amber badge "Archived"

If `canEdit && !isPreview`, make the badge clickable to cycle through statuses (draft → active → archived → draft).

Add horizon selector next to the status badge: a small `<Select>` with options 6, 12, 18, 24, 36 months. Read/write `scenarioHorizonAtom`.

Tab layout: Use the existing shadcn Tabs pattern. Each tab should be a `TabsTrigger` in a `TabsList`, with corresponding `TabsContent` panels.

Preserve the existing two-column layout in the Levers tab (controls left, dashboard right).
  </action>
  <verify>npm run build — passes. Scenario page loads with 5 tabs. Levers tab shows existing controls.</verify>
  <done>5-tab layout rendered. Status badge and horizon selector functional. Existing Levers/Compare functionality preserved.</done>
</task>

<task type="auto">
  <name>Task 2: Create AssumptionsEditor component</name>
  <files>src/features/scenarios/assumptions-editor.tsx</files>
  <action>
Create `src/features/scenarios/assumptions-editor.tsx` component.

**Props:** `canEdit: boolean`

**Data source:** Read/write `scenarioAssumptionsAtom` from `@/store/scenario-atoms`.

**UI structure:**

1. **Header:** "Key Assumptions" with "Add assumption" button (when `canEdit`)

2. **Assumptions list:** Each assumption is a card with:
   - `label` input (short title, e.g. "Market growth rate", "Customer retention")
   - `value` textarea (detailed assumption text, e.g. "We assume 15% YoY market growth based on industry reports from Q3 2025")
   - `category` select (optional): dropdown with common categories — "Market", "Financial", "Operational", "Regulatory", "Technical", "Other"
   - Delete button (X icon, when canEdit)

3. **Add flow:** Button adds a new empty assumption with `id: crypto.randomUUID()`, empty label and value.

4. **Read-only mode:** When `!canEdit`, show assumptions as read-only cards (no inputs, no delete, no add button).

5. **Auto-save:** Changes to the assumptions atom are automatically persisted by `useScenarioSync` (which already watches scenario state and debounces saves). No explicit save button needed.

Use shadcn components: `Card`, `Input`, `Textarea`, `Button`, `Select`.
Import lucide icons: `Plus`, `X`, `Lightbulb` (for header icon).

Wire into index.tsx: Import `AssumptionsEditor` and render it in the Assumptions tab content.
  </action>
  <verify>npm run build — passes. npm run lint — passes.</verify>
  <done>AssumptionsEditor renders assumption cards with add/edit/delete. Changes persist via scenario sync.</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] `npm run lint` passes
- [ ] Scenario page shows 5 tabs
- [ ] Assumptions tab renders AssumptionsEditor
- [ ] Levers tab shows existing controls (no regression)
- [ ] Compare tab shows existing comparison (no regression)
- [ ] Status badge and horizon selector work
</verification>

<success_criteria>
- 5-tab layout with proper navigation
- AssumptionsEditor CRUD works (add, edit, delete assumptions)
- Status cycling and horizon selection functional
- Existing scenario functionality (levers, comparison) unchanged
- Placeholder content for Variants and Decision tabs
</success_criteria>

<output>
After completion, create `.planning/phases/18-advanced-scenario-engine/18-03-SUMMARY.md`
</output>
